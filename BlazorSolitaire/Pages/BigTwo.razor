@page "/bigtwo"
@using BlazorSolitaire.Models.BigTwo
@using BlazorSolitaire.Models.Core
@using BlazorSolitaire.Models.Common.Enums
@using BlazorSolitaire.Pages.Partials

<h3>大老二 (Big Two)</h3>

<div class="row mb-3">
    <div class="col-12">
        <button class="btn btn-primary" @onclick="NewGame">New Game</button>
    </div>
</div>

@if (Game != null)
{
    @* Player 2 (Top) *@
    <div class="row justify-content-center mb-4">
        <div class="col-auto text-center">
            <h5>Player 2 (Computer)</h5>
             <div class="d-flex tile-container">
            @foreach (var card in Game.Player2Hand)
            {
               <div class="card-overlap">
                   <img src="images/solitaire/cardBackGrey.png" style="width: 70px;" />
               </div>
            }
             </div>
        </div>
    </div>

    <div class="row">
        @* Player 4 (Left) *@
        <div class="col-2 text-center">
             <h5>Player 4</h5>
              <div class="tile-container-vertical">
            @foreach (var card in Game.Player4Hand)
            {
                <div class="card-overlap-vertical">
                   <img src="images/solitaire/cardBackGrey.png" style="width: 70px;" />
               </div>
            }
            </div>
        </div>

        @* Table Center *@
        <div class="col-8 text-center" style="min-height: 200px; background-color: #2c3e50; border-radius: 10px; opacity: 0.8;">
            <p class="text-white mt-5">Table Area</p>
        </div>

        @* Player 3 (Right) *@
        <div class="col-2 text-center">
             <h5>Player 3</h5>
             <div class="tile-container-vertical">
            @foreach (var card in Game.Player3Hand)
            {
              <div class="card-overlap-vertical">
                   <img src="images/solitaire/cardBackGrey.png" style="width: 70px;" />
               </div>
            }
            </div>
        </div>
    </div>

    @* Player 1 (Bottom - User) *@
    <div class="row justify-content-center mt-4">
        <div class="col-auto text-center">
            <h5>Player 1 (User)</h5>
            <div class="d-flex tile-container">
                @foreach (var card in Game.Player1Hand)
                {
                    <div class="card-overlap">
                         @if(card is BigTwoCard bigTwoCard)
                         {
                              <img src="images/solitaire/@(bigTwoCard.ImageName).png" style="width: 80px;" title="@bigTwoCard.Suit @bigTwoCard.Value" />
                         }
                    </div>
                }
            </div>
        </div>
    </div>
}

<style>
    /* 簡單的重疊效果 CSS */
    .tile-container {
        perspective: 1000px;
    }
    .card-overlap {
        margin-right: -40px; /* 橫向重疊 */
        transition: transform 0.2s;
    }
    .card-overlap:last-child {
        margin-right: 0;
    }
    .card-overlap:hover {
        transform: translateY(-20px); /* 懸停浮起 */
        z-index: 10;
    }
</style>

@code {
    BigTwoGame Game;

    void NewGame()
    {
        Game = new BigTwoGame();
        Game.Deal();
    }
}
